{"version":3,"file":"openloginSessionManager.cjs.js","mappings":"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","sources":["webpack://@toruslabs/openlogin-session-manager/webpack/bootstrap","webpack://@toruslabs/openlogin-session-manager/webpack/runtime/compat get default export","webpack://@toruslabs/openlogin-session-manager/webpack/runtime/define property getters","webpack://@toruslabs/openlogin-session-manager/webpack/runtime/hasOwnProperty shorthand","webpack://@toruslabs/openlogin-session-manager/webpack/runtime/make namespace object","webpack://@toruslabs/openlogin-session-manager/external commonjs2 \"@babel/runtime/helpers/defineProperty\"","webpack://@toruslabs/openlogin-session-manager/external commonjs2 \"@toruslabs/base-session-manager\"","webpack://@toruslabs/openlogin-session-manager/external commonjs2 \"@toruslabs/eccrypto\"","webpack://@toruslabs/openlogin-session-manager/external commonjs2 \"@toruslabs/metadata-helpers\"","webpack://@toruslabs/openlogin-session-manager/./src/openloginSessionManager.ts","webpack://@toruslabs/openlogin-session-manager/./src/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@babel/runtime/helpers/defineProperty\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@toruslabs/base-session-manager\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@toruslabs/eccrypto\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@toruslabs/metadata-helpers\");","import { BaseSessionManager } from \"@toruslabs/base-session-manager\";\nimport { generatePrivate, getPublic, sign } from \"@toruslabs/eccrypto\";\nimport { decryptData, encryptData, keccak256 } from \"@toruslabs/metadata-helpers\";\n\nimport { OpenloginSessionManagerOptions, SessionApiResponse, SessionRequestBody } from \"./interfaces\";\n\nconst DEFAULT_SESSION_TIMEOUT = 86400;\nexport class OpenloginSessionManager<T> extends BaseSessionManager<T> {\n  sessionServerBaseUrl = \"https://broadcast-server.tor.us\";\n\n  sessionNamespace: string;\n\n  sessionTime: number = DEFAULT_SESSION_TIMEOUT;\n\n  private sessionId: string;\n\n  constructor({ sessionServerBaseUrl, sessionNamespace, sessionTime, sessionId }: OpenloginSessionManagerOptions = {}) {\n    super();\n\n    if (sessionServerBaseUrl) {\n      this.sessionServerBaseUrl = sessionServerBaseUrl;\n    }\n    if (sessionNamespace) this.sessionNamespace = sessionNamespace;\n    if (sessionTime) this.sessionTime = sessionTime;\n    if (sessionId) this.sessionId = sessionId;\n  }\n\n  get sessionKey(): string {\n    return this.sessionId?.padStart(64, \"0\") || \"\";\n  }\n\n  set sessionKey(value: string) {\n    if (!value) throw new Error(\"Session key is required\");\n    this.sessionId = value.padStart(64, \"0\");\n  }\n\n  static generateRandomSessionKey(): string {\n    return generatePrivate().toString(\"hex\").padStart(64, \"0\");\n  }\n\n  async createSession(data: T): Promise<string> {\n    const privKey = Buffer.from(this.sessionKey, \"hex\");\n    const pubKey = getPublic(privKey).toString(\"hex\");\n    const encData = await encryptData(this.sessionKey, data);\n    const signature = (await sign(privKey, keccak256(Buffer.from(encData, \"utf8\")))).toString(\"hex\");\n\n    const body: SessionRequestBody = {\n      key: pubKey,\n      data: encData,\n      signature,\n      namespace: this.sessionNamespace,\n      timeout: this.sessionTime,\n    };\n\n    await super.request({ method: \"POST\", url: `${this.sessionServerBaseUrl}/store/set`, data: body });\n\n    return this.sessionKey;\n  }\n\n  async authorizeSession(): Promise<T> {\n    super.checkSessionParams(this.sessionKey);\n    const pubkey = getPublic(Buffer.from(this.sessionKey, \"hex\")).toString(\"hex\");\n    const url = new URL(`${this.sessionServerBaseUrl}/store/get`);\n    url.searchParams.append(\"key\", pubkey);\n    if (this.sessionNamespace) url.searchParams.append(\"namespace\", this.sessionNamespace);\n\n    const result = await super.request<SessionApiResponse>({ url: url.toString() });\n    if (!result.message) {\n      throw new Error(\"Session Expired or Invalid public key\");\n    }\n\n    const response = await decryptData<T & { error?: string }>(this.sessionKey, result.message);\n    if (response.error) {\n      throw new Error(\"There was an error decrypting data.\");\n    }\n\n    return response;\n  }\n\n  async updateSession(data: Partial<T>): Promise<void> {\n    super.checkSessionParams(this.sessionKey);\n    const privKey = Buffer.from(this.sessionKey, \"hex\");\n    const pubKey = getPublic(privKey).toString(\"hex\");\n    const encData = await encryptData(this.sessionKey, data);\n    const signature = (await sign(privKey, keccak256(Buffer.from(encData, \"utf8\")))).toString(\"hex\");\n\n    const body: SessionRequestBody = {\n      key: pubKey,\n      data: encData,\n      signature,\n      namespace: this.sessionNamespace,\n    };\n\n    await super.request({ method: \"PUT\", url: `${this.sessionServerBaseUrl}/store/update`, data: body });\n  }\n\n  async invalidateSession(): Promise<boolean> {\n    super.checkSessionParams(this.sessionKey);\n    const privKey = Buffer.from(this.sessionKey, \"hex\");\n    const pubKey = getPublic(privKey).toString(\"hex\");\n    const encData = await encryptData(this.sessionKey, {});\n    const signature = (await sign(privKey, keccak256(Buffer.from(encData, \"utf8\")))).toString(\"hex\");\n\n    const data: SessionRequestBody = {\n      key: pubKey,\n      data: encData,\n      signature,\n      namespace: this.sessionNamespace,\n      timeout: 1,\n    };\n\n    await super.request({ method: \"POST\", url: `${this.sessionServerBaseUrl}/store/set`, data });\n    this.sessionId = \"\";\n    return true;\n  }\n}\n","export * from \"./interfaces\";\nexport * from \"./openloginSessionManager\";\n"],"names":["BaseSessionManager","generatePrivate","getPublic","sign","decryptData","encryptData","keccak256","DEFAULT_SESSION_TIMEOUT","OpenloginSessionManager","constructor","sessionServerBaseUrl","sessionNamespace","sessionTime","sessionId","arguments","length","undefined","_defineProperty","sessionKey","_this$sessionId","padStart","value","Error","generateRandomSessionKey","toString","createSession","data","privKey","Buffer","from","pubKey","encData","signature","body","key","namespace","timeout","request","method","url","authorizeSession","checkSessionParams","pubkey","URL","searchParams","append","result","message","response","error","updateSession","invalidateSession"],"sourceRoot":""}